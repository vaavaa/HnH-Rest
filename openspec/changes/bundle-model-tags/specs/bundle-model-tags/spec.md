# Bundle Model Tags (delta to Prompt Spec v1)

Эта спецификация расширяет Prompt Bundle и контракт render вводом тегов и фильтрации по типу модели.

---

## 1. Теги на бандле

### 1.1 PromptBundle (расширение)

К существующим полям бандла добавляется:

- **tags** (list of string): набор тегов, ассоциированных с бандлом. Может быть пустым. Один бандл может обслуживать несколько моделей (несколько тегов). Уникальность бандла по-прежнему (bundle_id, semver); теги в уникальный ключ не входят.

Примеры:

- `["gpt-4o", "default"]` — бандл подходит для запросов с model_type gpt-4o или default
- `["claude-3-opus"]` — только для этой модели
- `[]` — после миграции; при проверке по model_type такой бандл не подходит ни под какой переданный model_type

---

## 2. Контракт API

### 2.1 Создание бандла

- Запрос может содержать **tags** (опционально): список строк. Нормализация: уникальные непустые значения, разумная длина. По умолчанию — пустой список.

### 2.2 Чтение бандла

- Ответ всегда включает **tags**: list[str].

- Опционально: GET может поддерживать query **model_type**; тогда возвращаются только те версии бандла (по bundle_id), у которых в tags есть указанный тег.

### 2.3 Render

- Запрос может содержать **model_type** (опционально): строка, один основной тег для фильтрации.

- Правила:
  - Бандл выбирается по (bundle_id, semver) как в Prompt Spec v1.
  - Если **model_type** передан и не пустая строка (после strip): бандл считается подходящим только если в его **tags** есть значение, равное **model_type** (сравнение чувствительно к регистру). Иначе сервер возвращает **400 Bad Request** с телом ошибки.
  - Если **model_type** не передан или пустая строка (после strip) — проверка по тегам не выполняется (обратная совместимость).

**Тело ошибки 400 при неподдерживаемом model_type:**

- **detail** (string): сообщение для разработчика.
- **code** (string): `"bundle_unsupported_model"` — для программной обработки на клиенте.

---

## 3. Обратная совместимость

- Существующие бандлы после миграции имеют только `tags = []`.
- Клиенты, не передающие model_type (или передающие пустую строку), работают без изменений; у бандла с `tags = []` render выполняется как в Prompt Spec v1.
- Контракт сборки, audit и determinism из Prompt Spec v1 не меняется.
